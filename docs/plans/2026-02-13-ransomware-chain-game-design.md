# ランサムウェア攻撃チェーン ゲーム設計書

## 概要

プレイヤーが攻撃者「シャドウ」として、ターゲット企業「サイバーコーポレーション」に対して4フェーズの攻撃チェーンを体験するストーリー連鎖型ゲーム。

**設計思想**: 非エンジニアでも「なぜサイバーセキュリティが重要か」を直感的に理解できるよう、攻撃の因果関係（メール→PW漏洩→侵入→暗号化）をストーリーで体験する。

**ターゲット**: まず一般ユーザー向けに面白いゲームとして開発し、後から企業研修にも展開。

---

## ゲーム構造

### アプローチ: ストーリー連鎖型

PW奪取 → 社内侵入 → 権限昇格 → ランサムウェア展開の攻撃チェーンを、選択・操作・謎解きを交えてプレイする。

### スコアリング

- **ステルス度**（0-100）: 全フェーズ共通。雑な行動で検知されると低下
- **最終ランク**: S/A/B/C/D

---

## Phase 1: 偵察 & フィッシング

### 画面
ターゲット社員「田中」のSNSプロフィール風画面

### ユーザー操作
- SNS投稿（趣味、ペットの名前、出身地など）を閲覧し、「使えそうな情報」をクリックして収集
- 収集した情報をもとにフィッシングメールを作成（件名・本文・差出人をフォーム入力）

### AI役割
- Gemini APIがメールの説得力を評価（0-100）
- スコアが閾値超え → 社員がリンクをクリック → Phase 2へ
- 低スコアの場合、AIが「ここが怪しい」とフィードバック、やり直し可能

### 謎解き要素
- SNS投稿中に暗号めいたヒントが隠されている（例: プロフィール画像背景のホワイトボードに社内システムURL）
- 複数投稿を組み合わせて初めてフィッシングに使える情報が揃う（例: 「愛犬ポチと誕生日を祝った」+「1985年生まれ」→ PW候補「pochi1985」）

---

## Phase 2: パスワード突破

### 画面
ハッカーツール風のログイン画面

### ユーザー操作
- Phase 1で得た情報（ペット名、誕生日など）からPW候補を自分で推理・入力
- 試行回数が多いとロックアウト（ステルス度低下）

### AI役割
- 「パスワ」がPW強度に応じた演出で抵抗（弱PWは瞬時突破、強PWは時間がかかる）
- ユーザーの試行履歴に基づき動的ヒント生成（ただし答えは言わない）

### 謎解き要素
- ヒント:「この社員はペットの名前+生年を組み合わせる傾向がある」
- 正解の組み合わせを考える推理パズル
- 間違えるたびにロックアウトが近づく緊張感

---

## Phase 3: 社内ネットワーク侵入

### 画面
簡易的なネットワークマップ（ノードをクリックして探索）

### ユーザー操作
- PC、ファイルサーバー、管理者端末などのノードをクリックして探索
- 重要ファイルを見つける
- 管理者権限の取得を目指す

### AI役割
- 「マモル」が時間経過やユーザーの動きに応じて検知レベルを上げる
- 検知レベルが高まるとポートを閉じたりアクセスをブロック

### 謎解き要素
- ネットワークマップが段階的に開示。最初は見えないノードがある
- 特定ノードをスキャンすると隠されたサーバーやバックドアを発見
- ログファイルを読み解く謎解き: 管理者のアクセスパターンから権限昇格の手がかりを見つける（例: 「毎日18:00にメンテナンスアカウントでログイン」→ その時間帯に侵入するとセキュリティが緩い）

---

## Phase 4: ランサムウェア展開

### 画面
ファイルグリッド（既存のランサムウェアデモを拡張）

### ユーザー操作
- 暗号化するファイル範囲を選択（全部 or 一部）
- 暗号化速度 vs 検知リスクのトレードオフ
- 身代金要求メッセージを作成

### AI役割
- 「バックアップン」がバックアップから復旧を試みる
- ユーザーがバックアップも暗号化していたかどうかで結果変動
- 全フェーズの行動ログから最終評価レポートを生成

### 謎解き要素
- バックアップの場所を先に見つけて無効化しないと暗号化しても復旧される
- ネットワークマップからバックアップサーバーの位置を特定
- 「どの順序で暗号化するか」が戦略パズル（重要ファイル優先？バックアップ先潰し優先？）

---

## AI連携設計

| 箇所 | AIの役割 | 入力 | 出力 |
|---|---|---|---|
| Phase 1 | フィッシングメール評価 | ユーザー作成メール | 説得力スコア + フィードバック |
| Phase 2 | PW推理ヒント生成 | ユーザーの試行履歴 | 動的ヒント |
| Phase 3 | 防御側AIの動的対応 | ユーザーの探索行動 | マモルの検知アクション + 会話 |
| Phase 4 | 結果の評価レポート | 全フェーズの行動ログ | 攻撃成功度 + 防御方法の解説 |

**API**: Google Gemini API を使用。APIキーは環境変数 `GEMINI_API_KEY` で管理。
**SDK**: `google-generativeai` (Python)

---

## テクニカルアーキテクチャ

### フロントエンド構成

```
src/
  components/
    game/                    # ゲームモード
      GameContainer.jsx      # ゲーム全体の状態管理
      PhaseManager.jsx       # フェーズ遷移制御
      phases/
        ReconPhase.jsx       # Phase 1: 偵察 & フィッシング
        PasswordPhase.jsx    # Phase 2: PW突破
        NetworkPhase.jsx     # Phase 3: ネットワーク侵入
        RansomwarePhase.jsx  # Phase 4: ランサムウェア展開
      ui/
        StealthMeter.jsx     # ステルス度メーター
        PhaseTransition.jsx  # フェーズ間演出
        ScoreReport.jsx      # 最終レポート
```

### バックエンド構成

```
backend/
  routers/
    game.py                  # 既存を拡張
  services/
    ai_service.py            # Gemini API統合
    game_state.py            # ゲーム状態管理（メモリ内）
  scenarios/
    ransomware_chain.py      # シナリオデータ定義
```

### データフロー

```
ユーザー操作 → フロントエンド → POST /api/game/action → バックエンド
                                                          ↓
                                                    ゲーム状態更新
                                                          ↓
                                                    Gemini AI判定（必要時）
                                                          ↓
                                                    レスポンス返却
                                                          ↓
                                              フロントエンド状態更新 + 演出
```

---

## 最終レポート（教育要素）

ゲーム終了後に表示される攻撃レポート画面:

- **攻撃サマリー**: 各フェーズの所要時間、ステルス度推移グラフ
- **あなたの攻撃手法**: 実際に使った手法の解説（例:「あなたはフィッシングメールで社員を騙しました。これは実際の攻撃の91%で使われる手法です」）
- **防御ガイド**: 各フェーズで「こうすれば防げた」をAIが生成
- **総合スコア**: S/A/B/C/D ランク

---

## スコープ

### 今回実装するもの
- 4フェーズの攻撃チェーンゲーム（ランサムウェアシナリオ）
- Gemini API統合（フィッシング評価、動的防御、レポート生成）
- ステルス度システム
- 各フェーズの謎解き要素
- 最終攻撃レポート

### 今回実装しないもの
- 防御サイド（Defense Side）
- 他の攻撃シナリオ
- ユーザー認証/データ永続化
- 管理者ダッシュボード
- マルチプレイヤー
