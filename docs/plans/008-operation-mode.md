# 008: OPERATION: RANSOMWARE（連続モード）

## 概要

Stage 1〜4 を一連の攻撃チェーンとして連続プレイするモード。ストーリーが繋がっており、前のステージの結果が次のステージに影響する。

## 要件ソース

- docs/features.md#OPERATION: RANSOMWARE（フィーチャーモード）
- docs/features.md#共通機能 — 結果画面（スコアリング: 各ステージ合算 + 連続クリアボーナス）

## 依存

- 003: Stage 1 — ショルダーハッキング（完了必須）
- 004: Stage 2 — パスワードクラッキング（完了必須）
- 005: Stage 3 — フィッシング攻撃（完了必須）
- 006: Stage 4 — ランサムウェア侵攻（完了必須）
- 007: 結果画面（完了必須）

## タスク

### OPERATIONモード管理

- [ ] `src/contexts/GameContext.tsx` に OPERATIONモード状態を追加
  - `isOperationMode: boolean`
  - `operationProgress: { currentStageIndex: number, stageResults: StageResult[] }`
  - 各ステージ間のコンテキストデータ引き継ぎ

### ステージ間データ連携

- [ ] Stage 1 → Stage 2: ショルダーハッキングで発見した情報（ターゲット名・メールアドレス等）をStage 2のターゲットプロフィールに反映
- [ ] Stage 2 → Stage 3: パスワードクラッキングで突破したアカウント情報をStage 3のフィッシングメール作成時に利用可能に
- [ ] Stage 3 → Stage 4: フィッシングで得た権限情報をStage 4の初期侵入フェーズに反映

### OPERATIONフロー制御

- [ ] ステージ間のトランジション画面
  - 「ミッション進行中」の演出（TerminalText でストーリー接続テキスト表示）
  - 前ステージの結果サマリー表示
  - 「次のフェーズへ進む」ボタン

- [ ] 途中離脱への対応
  - 中断時の状態保存（GameContext内。ブラウザリロードでリセットはMVPとして許容）
  - 各ステージ失敗時の処理（低スコアでも次に進める設計）

### OPERATIONモード用Geminiプロンプト

- [ ] 各ステージのプロンプトに前ステージの結果コンテキストを追加する仕組み
- [ ] ストーリー接続テキスト生成プロンプト（ステージ間の繋ぎの説明文）

### スコアリング

- [ ] 各ステージのスコア合算
- [ ] 連続クリアボーナス（全4ステージクリア時のボーナス点数）
- [ ] OPERATION専用の結果画面（4ステージの内訳 + 総合スコア + 総合ランク）

### OPERATIONカードからの遷移

- [ ] ハブ画面のOPERATIONカードタップ時のフロー
  - GameContext の isOperationMode を true に設定
  - Stage 1 から順番に開始
  - 各ステージ完了後、結果画面ではなくトランジション画面→次ステージへ
  - Stage 4 完了後にOPERATION専用結果画面を表示

## 受け入れ条件

- OPERATIONカードからStage 1が開始されること
- 各ステージクリア後、次のステージに自動的に遷移すること（トランジション画面経由）
- 前ステージの結果が次ステージに影響すること（ターゲット情報・認証情報・権限情報の引き継ぎ）
- 全4ステージクリア後にOPERATION専用結果画面が表示されること
- 総合スコア（合算 + ボーナス）が正しく計算されること
- 個別ステージモードとOPERATIONモードの両方で各ステージが正しく動作すること

## 備考

- OPERATIONモードは全ステージの実装完了後に着手する
- ステージ間のデータ連携は、各ステージのGeminiプロンプトに前ステージの結果をコンテキストとして渡す形で実現する
- MVP段階では、ステージ間の影響は「フレーバーテキスト」程度でも良い（例: Stage 1で見つけた名前がStage 2のプロフィールに表示される、等）
