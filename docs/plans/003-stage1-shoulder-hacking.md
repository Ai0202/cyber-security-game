# 003: Stage 1 — ショルダーハッキング

## 概要

攻撃者として、オフィスや公共の場でターゲットのPC/スマホ画面を覗き見して機密情報を盗む体験を提供する。制限時間つきのインタラクティブ観察ゲーム。

## 要件ソース

- docs/features.md#Stage 1: ショルダーハッキング
- docs/index.md#各ステージ共通レイアウト
- docs/openapi.yaml#/gemini/generate-scenario, /gemini/evaluate

## 既存実装の活用

- 新規実装（既存ブランチに該当するゲームロジックなし）
- `feature/ransomware-chain-game` の `DemoView.jsx` にショルダーハックのデモがあるが、ゲームロジックとは異なる

## タスク

### ゲームコンポーネント (`src/components/stages/shoulder-hacking/`)

- [ ] `ShoulderHackingGame.tsx`: ゲーム全体の制御（開始→プレイ→終了フロー）
  - ゲーム状態管理: 'briefing' | 'playing' | 'timeup' | 'completed'
  - Gemini API でシナリオ取得
  - タイマー管理（30秒カウントダウン）
  - 発見した情報の収集管理
  - スコア計算と結果画面への遷移

- [ ] `SceneDisplay.tsx`: シーン表示コンポーネント
  - シチュエーション説明（場所、ターゲットの描写）をテキストで表示
  - PC/スマホ画面のモックUI表示（カード形式で複数の画面要素を配置）
  - 各画面要素にタップ可能なホットスポットを配置
  - タップで情報を「発見」→ 発見済みマーカー表示

- [ ] `InfoCollector.tsx`: 発見した情報の表示パネル
  - 発見済み情報のリスト表示（アイコン + カテゴリ + 内容）
  - カテゴリ: パスワード(30pt)、個人情報(20pt)、業務機密(25pt)
  - 現在のスコア表示

- [ ] `Timer.tsx`: カウントダウンタイマー
  - 30秒の円形プログレスバー
  - 残り10秒で赤く点滅
  - タイムアップ時のアニメーション

### Gemini APIプロンプト (`src/lib/prompts/shoulder-hacking.ts`)

- [ ] シナリオ生成プロンプト:
  - 場所（カフェ / オフィス / 電車内など）をランダム選択
  - ターゲットの職種・状況を生成
  - 画面上の情報リスト（発見すべき項目: パスワード付箋、メール本文、個人情報等）を構造化JSONで返却
  - 各情報にカテゴリ・点数・配置位置ヒントを含める

- [ ] 評価プロンプト:
  - 発見した情報リストを受け取り、スコアと「この情報がどう悪用されるか」のフィードバックを生成

### モックデータ

- [ ] Gemini API未接続時のフォールバック用ハードコードシナリオ（2〜3パターン）

### ステージページ (`src/app/stage/shoulder-hacking/page.tsx`)

- [ ] 共通レイアウト適用（ヘッダー: ステージ名 + 戻るボタン）
- [ ] ShoulderHackingGame コンポーネントの配置
- [ ] ゲーム完了時に結果画面へ遷移（スコアデータをパラメータとして渡す）

## 受け入れ条件

- Gemini APIでシナリオが動的生成されること（毎回異なるシチュエーション）
- 30秒のカウントダウンが正しく動作すること
- 画面上の情報をタップして収集できること
- 発見した情報にカテゴリ別の点数が付与されること
- タイムアップまたは全情報発見でゲーム終了し、結果画面に遷移すること
- モックモードで動作すること（GEMINI_API_KEY未設定時）

## 備考

- 画像は使用せず、UIモック（カード形式のテキスト・アイコン配置）で画面を表現する
- Gemini APIが返すシナリオには、発見すべき情報の一覧とそのカテゴリ・配置情報を含める
