# 007: 結果画面

## 概要

各ステージクリア後に表示される結果画面。スコア、ランク、AIフィードバック、学習ポイントを表示し、プレイヤーの行動を振り返る。

## 要件ソース

- docs/features.md#共通機能 — 結果画面
- docs/index.md#結果画面（`/stage/[stageId]/result`）
- docs/openapi.yaml#/gemini/feedback

## 既存実装の活用

| 流用元ブランチ | 内容 | 備考 |
|---------------|------|------|
| `feature/ransomware-chain-game` | GameContainer.jsx のレポート表示部分 | ランク判定、スコア表示、フィードバック表示のロジックあり。UIは刷新 |

## タスク

### 結果画面コンポーネント (`src/components/result/`)

- [ ] `ScoreDisplay.tsx`: スコア表示
  - 円形プログレスバー（0〜100）
  - 0からスコアまでのアニメーション（1.5秒、Framer Motion）
  - スコア数値のカウントアップアニメーション
  - サイバーパンク風デザイン（ネオングロー枠）

- [ ] `RankBadge.tsx`: ランク表示
  - S / A / B / C / D のバッジ
  - スコア表示後に遅延表示（0.5秒後）
  - Framer Motion でバウンスエフェクト
  - ランクに応じた色分け（S: ゴールド, A: グリーン, B: ブルー, C: オレンジ, D: レッド）

- [ ] `AIFeedback.tsx`: AIフィードバック表示
  - Gemini API の `/gemini/feedback` エンドポイントからストリーミング受信
  - タイプライターエフェクトで1文字ずつ表示（TerminalText使用）
  - ストリーミング完了後にフル表示に切り替え

- [ ] `ScoreBreakdown.tsx`: スコア内訳表示
  - カテゴリ別のスコアバー（取得pt / 最大pt）
  - 各カテゴリのコメント表示
  - アコーディオン式で展開/折りたたみ

- [ ] `LearningPoints.tsx`: 学習ポイント表示
  - カード形式で3〜5項目を表示
  - アイコン + タイトル + 説明
  - Framer Motion で順番にスライドイン

- [ ] `ActionButtons.tsx`: アクションボタン
  - 「もう一度プレイ」ボタン（CyberButton、同じステージのゲーム画面へ）
  - 「ステージ選択に戻る」ボタン（CyberButton、ハブ画面へ）

### 結果画面ページ (`src/app/stage/[stageId]/result/page.tsx`)

- [ ] URLパラメータから stageId を取得
- [ ] GameContext からスコアデータを取得
- [ ] 各コンポーネントの配置とレイアウト
- [ ] 全体のフェードイン + スライドアップアニメーション
- [ ] スコアデータがない場合（直接URL遷移等）はハブ画面にリダイレクト

### Gemini API フィードバックストリーミング

- [ ] `/api/gemini/feedback` エンドポイントの実装（001で基盤を作成済み。ここでは呼び出し側）
- [ ] Server-Sent Events (SSE) でストリーミング受信
- [ ] クライアント側のストリーミング処理（`EventSource` or `fetch` + ReadableStream）

## 受け入れ条件

- スコアが円形プログレスバーで0からアニメーション表示されること（1.5秒）
- ランクバッジがバウンスエフェクトで表示されること
- AIフィードバックがタイプライターエフェクトでストリーミング表示されること
- スコア内訳が各カテゴリ別に表示されること
- 学習ポイントが3〜5項目カード形式で表示されること
- 「もう一度プレイ」で同じステージのゲーム画面に遷移すること
- 「ステージ選択に戻る」でハブ画面に遷移すること
- スコアデータなしでの直接アクセス時にリダイレクトされること

## 備考

- ストリーミング表示はUX上重要（AIが「考えている」感を演出）。SSEが技術的に困難な場合は、通常のAPIレスポンスをタイプライターエフェクトで表示するフォールバックも検討
